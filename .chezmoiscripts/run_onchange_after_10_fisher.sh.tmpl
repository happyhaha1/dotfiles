#!/bin/bash
# Check and install fisher plugin manager and plugins for fish shell

set -eufo pipefail

# Only run if using fish shell
if [[ "$SHELL" != *"fish"* ]]; then
    echo ":: [fish] Not using fish shell (current: $SHELL), skipping fisher check"
    exit 0
fi

echo ":: [fish] Checking fisher plugin manager..."

# Check if fisher is installed
if fish -c 'fisher -v' 2>/dev/null; then
    echo ":: [fish] fisher is already installed"
else
    echo ":: [fish] fisher not found, installing..."
    fish -c 'curl -sL https://git.io/fisher | source && fisher install jorgebucaran/fisher'
    echo ":: [fish] fisher installed successfully"
fi

# Check and install plugins
echo ":: [fish] Checking plugins..."

# Get installed plugins
installed_plugins=$(fish -c 'fisher list 2>/dev/null')

{{- range .fisher.shared }}
plugin="{{ . }}"

if echo "$installed_plugins" | grep -q "^$plugin$"; then
    echo ":: [fish] Plugin $plugin is already installed"
else
    echo ":: [fish] Installing plugin $plugin..."
    fish -c "fisher install $plugin"
    echo ":: [fish] Plugin $plugin installed"
fi
{{- end }}
