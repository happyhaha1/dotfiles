---
description: 根据变更生成 Commit 消息，智能识别变更类型并生成规范的 Commit Message,并帮助我提交代码
---
## 命令选项

- `--no-verify` - 跳过提交前检查（lint、build、generate:docs）
- `--all` - 提交所有变更
- `--files <files>` - 指定提交的文件（逗号分隔）
- `--separate` - 多个文件分开提交
- `--message <msg>` - 使用自定义 message

## 核心功能流程

1. **提交前检查**（除非使用 `--no-verify`）
   - `pnpm lint` - 确保代码质量
   - `pnpm build` - 验证构建成功
   - `pnpm generate:docs` - 更新文档

2. **分析变更**
   - 使用 `git status` 检查哪些文件已暂存
   - 如果暂存了 0 个文件，使用 `git add` 自动添加所有修改和新文件
   - 执行 `git diff` 分析当前变更内容

3. **识别类型**
   - 根据文件路径和变更内容判断变更类型
   - 分析差异以确定是否存在多个不同的逻辑更改
   - 如果检测到多个不同的更改，建议将提交拆分为多个较小的提交

4. **生成消息**
   - 匹配对应的 emoji 前缀
   - 生成 2-4 个候选 commit message
   - 使用约定式提交格式和 emoji

5. **用户选择**
   - 展示候选 message 供用户选择
   - 支持用户自定义 message
   - 确认提交内容

6. **执行提交**
   - 执行 `git add`（如需要）
   - 执行 `git commit` 完成提交
   - 审查提交差异以确保消息与更改匹配

## 集成工具

- `bash` - 执行 git 命令和代码质量检查
- `question` - 向用户展示选项并获取选择
- `str_replace` - 编辑文件（如需要）
- `view` - 查看文件内容和差异

## 提交最佳实践

### 基本原则

- **提交前验证**：确保代码已 lint、构建正确且文档已更新
- **原子提交**：每个提交应包含服务于单一目的的相关更改
- **拆分大型更改**：如果更改涉及多个关注点，将它们拆分为单独的提交
- **约定式提交格式**：使用格式 `<emoji> <type>: <description>`
- **现在时、祈使语气**：将提交消息写成命令（例如，"add feature" 而不是 "added feature"）
- **简洁的第一行**：将第一行保持在 72 个字符以下
- **使用中文描述**：message 应简洁明了的中文说明

### 提交类型

基本类型：
- `feat` - 新功能
- `fix` - 错误修复
- `docs` - 文档更改
- `style` - 代码样式更改（格式化等）
- `refactor` - 既不修复错误也不添加功能的代码更改
- `perf` - 性能改进
- `test` - 添加或修复测试
- `chore` - 构建过程、工具等的更改

扩展类型：
- `ci` - CI/CD 改进
- `build` - 构建系统或外部依赖项的更改
- `revert` - 还原之前的提交

## Emoji 使用指南

### 核心 Emoji 对照表

| Emoji | 类型 | 适用场景 | 示例 |
|-------|------|---------|------|
| ✨ | `feat` | 新功能、新特性 | ✨ feat: 添加用户认证系统 |
| 🐛 | `fix` | 修复 bug、错误 | 🐛 fix: 解决内存泄漏问题 |
| 📝 | `docs` | 文档更新、注释 | 📝 docs: 更新 API 文档 |
| 💄 | `style` | 代码格式、风格调整 | 💄 style: 统一代码缩进格式 |
| ♻️ | `refactor` | 代码重构、优化 | ♻️ refactor: 简化错误处理逻辑 |
| ⚡️ | `perf` | 性能优化 | ⚡️ perf: 优化列表渲染性能 |
| ✅ | `test` | 添加测试、测试相关 | ✅ test: 添加用户登录单元测试 |
| 🔧 | `chore` | 工具、脚本、配置 | 🔧 chore: 更新 ESLint 配置 |
| 🚀 | `ci` | CI/CD 改进 | 🚀 ci: 优化构建流程 |
| 📦️ | `chore` | 资源、依赖、包 | 📦️ chore: 更新依赖包版本 |
| 🗑️ | `revert` | 删除文件、功能 | 🗑️ revert: 移除废弃代码 |
| 🔀 | `chore` | 合并分支 | 🔀 chore: 合并开发分支 |
| ⏪️ | `revert` | 回滚变更 | ⏪️ revert: 回滚错误提交 |

### 扩展 Emoji 对照表

| Emoji | 类型 | 场景说明 |
|-------|------|---------|
| 🚨 | `fix` | 修复编译器/linter 警告 |
| 🔒️ | `fix` | 修复安全问题 |
| 🚑️ | `fix` | 关键热修复 |
| 🩹 | `fix` | 非关键问题的简单修复 |
| 🥅 | `fix` | 捕获错误 |
| 👽️ | `fix` | 由于外部 API 更改而更新代码 |
| 🔥 | `fix` | 删除代码或文件 |
| 💚 | `fix` | 修复 CI 构建 |
| ✏️ | `fix` | 修复拼写错误 |
| 🔇 | `fix` | 删除日志 |
| 🎨 | `style` | 改进代码的结构/格式 |
| 🏷️ | `feat` | 添加或更新类型 |
| 💬 | `feat` | 添加或更新文本和字面量 |
| 🌐 | `feat` | 国际化和本地化 |
| 👔 | `feat` | 添加或更新业务逻辑 |
| 📱 | `feat` | 响应式设计工作 |
| 🚸 | `feat` | 改进用户体验/可用性 |
| 🧵 | `feat` | 添加或更新与多线程或并发相关的代码 |
| 🔍️ | `feat` | 改进 SEO |
| 🔊 | `feat` | 添加或更新日志 |
| 🥚 | `feat` | 添加或更新彩蛋 |
| 🚩 | `feat` | 添加、更新或删除功能标志 |
| 💫 | `ui` | 添加或更新动画和过渡 |
| 🦺 | `feat` | 添加或更新与验证相关的代码 |
| ✈️ | `feat` | 改进离线支持 |
| ♿️ | `feat` | 改进可访问性 |
| 💥 | `feat` | 引入破坏性更改 |
| 📈 | `feat` | 添加或更新分析或跟踪代码 |
| 🧑‍💻 | `chore` | 改进开发者体验 |
| 👥 | `chore` | 添加或更新贡献者 |
| 🚚 | `refactor` | 移动或重命名资源 |
| 🏗️ | `refactor` | 进行架构更改 |
| ⚰️ | `refactor` | 删除死代码 |
| ➕ | `chore` | 添加依赖项 |
| ➖ | `chore` | 删除依赖项 |
| 📌 | `chore` | 将依赖项固定到特定版本 |
| 🌱 | `chore` | 添加或更新种子文件 |
| 🎉 | `chore` | 开始项目 |
| 🔖 | `chore` | 发布/版本标签 |
| 📄 | `chore` | 添加或更新许可证 |
| 🙈 | `chore` | 添加或更新 .gitignore 文件 |
| 🍱 | `assets` | 添加或更新资源 |
| 💡 | `docs` | 在源代码中添加或更新注释 |
| 🧪 | `test` | 添加失败测试 |
| 🤡 | `test` | 模拟事物 |
| 📸 | `test` | 添加或更新快照 |
| 👷 | `ci` | 添加或更新 CI 构建系统 |
| 🚧 | `wip` | 进行中的工作 |
| 🗃️ | `db` | 执行数据库相关更改 |
| ⚗️ | `experiment` | 执行实验 |

## Message 格式规范

### 标准格式

```
<emoji> <type>: <简要描述>

[可选] 详细说明：
- 变更点 1
- 变更点 2
- 变更点 3
```

### 格式要求

1. **第一行（标题）**
   - 不超过 72 个字符
   - 使用 emoji + 类型 + 简要描述
   - 使用现在时、祈使语气
   - 简洁明了，突出重点

2. **详细说明（可选）**
   - 空一行后开始
   - 说明为什么做这个改动
   - 列出具体变更点
   - 使用中文清晰表达

3. **特殊情况**
   - 破坏性变更：使用 `💥` emoji 并在详细说明中注明 `BREAKING CHANGE:`
   - 关闭 issue：在详细说明中添加 `Closes #123`

## 拆分提交指南

当变更较大或涉及多个关注点时，应考虑拆分提交：

### 拆分标准

1. **不同关注点**
   - 对代码库不相关部分的更改
   - 例如：同时修改前端和后端

2. **不同类型的更改**
   - 混合功能、修复、重构等
   - 例如：既添加功能又修复 bug

3. **文件模式**
   - 对不同类型文件的更改
   - 例如：源代码 vs 文档 vs 配置

4. **逻辑分组**
   - 单独理解或审查会更清晰的更改
   - 例如：可以独立测试的功能模块

5. **大小控制**
   - 如果拆分会更清晰的非常大的更改
   - 例如：超过 500 行的改动

## 使用示例

### 示例 1：简单提交

```
用户：「帮我提交这个修改」

系统：
1. 运行 lint、build、docs 检查
2. 分析 git diff
3. 生成候选 messages：
   - ✨ feat: 添加用户认证功能
   - 🐛 fix: 修复登录验证问题
   - ♻️ refactor: 优化认证逻辑
4. 用户选择或自定义
5. 执行 git commit
```

### 示例 2：多文件分开提交

```
用户：「分开提交这些文件」

系统：
1. 识别 3 个修改的文件
2. 文件 1: src/auth.ts
   - 生成: ✨ feat: 添加 JWT 认证支持
3. 文件 2: docs/api.md
   - 生成: 📝 docs: 更新认证 API 文档
4. 文件 3: package.json
   - 生成: ➕ chore: 添加 jsonwebtoken 依赖
5. 依次提交每个文件
```

### 示例 3：自定义 message

```
用户：「用这个 message 提交：优化性能」

系统：
1. 检查变更内容
2. 建议更规范的格式：
   - ⚡️ perf: 优化列表渲染性能
   - ⚡️ perf: 优化性能
3. 使用用户选择的 message
4. 执行 commit
```

### 示例 4：跳过检查的快速提交

```
用户：「快速提交，跳过检查」

命令：/commit --no-verify

系统：
1. 跳过 lint、build、docs 检查
2. 直接分析变更
3. 生成 message
4. 执行提交
```

### 示例 5：提交所有变更

```
命令：/commit --all

系统：
1. git add . 添加所有变更
2. 分析所有 diff
3. 如果变更跨多个关注点，建议拆分
4. 生成对应的 commit message
5. 执行提交
```

## 完整的 Commit Message 示例

### 新功能

```
✨ feat: 添加用户认证系统

实现了完整的用户认证功能：
- 添加 JWT token 生成和验证
- 实现登录和注册接口
- 添加权限中间件
- 支持 token 刷新机制
```

### Bug 修复

```
🐛 fix: 解决渲染过程中的内存泄漏

修复了组件卸载时未清理事件监听器导致的内存泄漏：
- 在 useEffect 中添加清理函数
- 移除所有事件监听器
- 清理定时器和订阅
```

### 文档更新

```
📝 docs: 更新 API 文档

更新了新端点的文档说明：
- 添加认证相关接口文档
- 更新请求参数说明
- 添加响应示例
- 补充错误码说明
```

### 重构

```
♻️ refactor: 简化错误处理逻辑

优化了解析器中的错误处理：
- 统一错误类型定义
- 简化异常捕获逻辑
- 提高代码可读性
```

### 性能优化

```
⚡️ perf: 优化列表渲染性能

通过虚拟滚动提升大列表渲染性能：
- 实现虚拟滚动组件
- 减少 DOM 节点数量
- 性能提升约 60%
```

### 安全修复

```
🔒️ fix: 加强认证密码要求

提升系统安全性：
- 要求密码长度至少 8 位
- 必须包含大小写字母和数字
- 添加密码强度验证
- 更新用户提示信息
```

### 样式调整

```
🎨 style: 重组组件结构提高可读性

改善代码组织结构：
- 按功能分组相关代码
- 统一命名规范
- 添加必要的注释
- 优化导入顺序
```

### 多个提交的拆分示例

**变更内容**：同时修改了类型定义、文档、依赖和测试

**拆分后的提交**：
```
提交 1: 🏷️ feat: 添加新的 solc 版本类型定义
提交 2: 📝 docs: 更新 solc 版本文档说明
提交 3: ➕ chore: 更新 package.json 依赖
提交 4: ✅ test: 添加 solc 版本功能单元测试
提交 5: 🚨 fix: 解决新代码的 linting 问题
```

## 注意事项

### 提交前

1. **确保代码质量**
   - 默认会运行 lint、build、docs 检查
   - 如果检查失败，会询问是否继续
   - 建议先修复问题再提交

2. **检查暂存区**
   - 如果已暂存特定文件，只提交这些文件
   - 如果没有暂存，会自动添加所有修改

3. **审查差异**
   - 仔细查看 git diff 输出
   - 确认所有改动都是预期的
   - 移除调试代码和注释

### 提交时

1. **选择合适的 message**
   - 根据实际变更选择最匹配的类型
   - 确保描述准确简洁
   - 必要时添加详细说明

2. **保持一致性**
   - 相同类型的变更使用相同的 emoji
   - 遵循团队的提交规范
   - 保持 message 格式统一

3. **多文件处理**
   - 如果多个文件涉及不同关注点，使用 `--separate`
   - 每个 message 应准确对应文件变更
   - 避免将不相关的改动合并到一个提交

### 提交后

1. **验证提交**
   - 使用 `git log` 查看提交历史
   - 确认 message 格式正确
   - 检查是否有遗漏的文件

2. **处理错误**
   - 如果 message 有误，使用 `git commit --amend` 修改
   - 如果需要拆分，使用 `git reset` 后重新提交
   - 如果需要回滚，使用 `⏪️ revert` 类型

## 常见问题

**Q: 检查失败了怎么办？**
A: 系统会询问是否继续提交，建议先修复问题，或使用 `--no-verify` 跳过检查。

**Q: 如何自定义 commit message？**
A: 使用 `--message` 选项，或在候选列表中选择"自定义"。

**Q: 多个文件应该一起提交还是分开？**
A: 如果文件涉及同一个功能或修复，可以一起提交；如果是不同关注点，建议使用 `--separate` 分开提交。

**Q: emoji 和类型如何选择？**
A: 根据变更的主要目的选择：新功能用 `✨ feat`，修复用 `🐛 fix`，文档用 `📝 docs`，等等。

**Q: 提交后发现 message 写错了怎么办？**
A: 如果还没 push，使用 `git commit --amend` 修改最后一次提交；如果已 push，可以用 `⏪️ revert` 回滚后重新提交。

## 扩展阅读

- [约定式提交规范](https://www.conventionalcommits.org/zh-hans/)
- [Gitmoji 使用指南](https://gitmoji.dev/)
- [Git 最佳实践](https://git-scm.com/book/zh/v2)
- [如何写好 Git Commit Message](https://chris.beams.io/posts/git-commit/)
